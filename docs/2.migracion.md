# Migración a Spring Boot

Para migrar de Spring Boot 1.x a 3.x, es posible usar una "receta" de OpenRewrite. Esta receta aplica una serie de transformaciones en el código fuente que actualizan librerías, archivos de configuración y código fuente. Una vez se han ejecutado las reglas, el código queda actualizado y es necesario hacer pruebas para ver si la migración fue exitosa.

---

## Determinando la receta a utilizar

1. Visite la página web con recetas de Openwrite 
    - Catálogo completo en https://docs.openrewrite.org/recipes y
    - Recetas para actualizar Spring en https://docs.openrewrite.org/recipes/java/spring

2. Visite la página que tiene la receta para migrar de Spring Boot 1.x a Spring Boot 3.0 
    - en https://docs.openrewrite.org/recipes/java/spring/boot3/upgradespringboot_3_0 

    En esa misma página, revise el código para `Maven POM` en la sección `Usage`


## Agregando la receta a Maven

> Para hacer la migración es necesario modificar el `pom.xml`
> - agregar, en el `build`, el plugin de `rewrite-maven-plugin`
> - dentro de la sección `configuration` agregar una sección de `activeRecipes`
> - incluir la receta `org.openrewrite.java.spring.boot3.UpgradeSpringBoot_3_0`

---

3. Modifique el archivo `pom.xml` y copie el siguiente código en la sección `<plugin>`

    Copie el código en la sección `<plugin>`

    ```
      <plugin>
        <groupId>org.openrewrite.maven</groupId>
        <artifactId>rewrite-maven-plugin</artifactId>
        <version>6.8.0</version>
        <configuration>
          <exportDatatables>true</exportDatatables>
          <activeRecipes>
            <recipe>org.openrewrite.java.spring.boot3.UpgradeSpringBoot_3_0</recipe>
          </activeRecipes>
        </configuration>
        <dependencies>
          <dependency>
            <groupId>org.openrewrite.recipe</groupId>
            <artifactId>rewrite-spring</artifactId>
            <version>6.7.0</version>
          </dependency>
        </dependencies>
      </plugin>
    ```

4. Agregue el código en el archivo `pom.xml` del proyecto, dentro de la sección `<build><plugins>` 


## Ejecutando la migración

5. Ejecute `mvn rewrite:dryRun`, en una terminal de línea de comandos, para revisar si la migración puede descargar los archivos y la configuración es correcta.

    ```
    # en una terminal
    mvn rewrite:dryRun
    ```

6. Ejecute `mvn rewrite:run`, en una terminal de línea de comandos, para ejecutar la migración.

    ```
    # en una terminal
    mvn rewrite:run
    ```

## Ejecutando pruebas de regresión

Cuando se ejecutan refactorizaciones automáticas, es posible que los cambios sobre el código causen *regresiones*, es decir, pueden causar que algunas funcionalidades dejen de funcionar. Una *prueba de regresión*, es una prueba de todo el software (o de un porcentaje grande de funcionalidades) que busca determinar estas regresiones.

7. Ejecute `sdk install java ...` para cambie la versión de Java por una versión más reciente. Por ejemplo, ejecute `sdk install java 24-zulu` para instalar Azul Java SDK versión 24.

    ```
    # en una terminal
    sdk install java 24-zulu
    ```

8. Si usa Visual Studio Code (o algún IDE similar), cargue de nuevo la ventana para que el editor use la nueva versión en Java

  - Presione `F1` o `Shift +  Ctrol + P`
  - Ejecute el comando `> Developer: Reload Window` 


9. Ejecute las pruebas de regresión para revisar si el software funciona luego de la migración

    ```
    # en la terminal
    mvn package test
    ```
